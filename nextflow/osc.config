params {
    config_profile_description = 'Config for running Nextflow pipelines at OSC'
    config_profile_contact     = 'Jelmer Poelstra, poelstra.1@osu.edu'

    max_memory                 = '2.9 TB'
    max_cpus                   = 48
    max_time                   = '336 h'

    outdir                     = ''
    tracedir                   = "${params.outdir}/pipeline_info"
    publish_dir_mode           = 'copy'
}

process {
    // https://www.osc.edu/resources/technical_support/supercomputers/pitzer/batch_limit_rules
    //clusterOptions= { "--account=${params.project} ${params.clusterOptions ?: ''}" }
    //queue = { task.time > 168 ? 'longserial' : 'serial' }
    //queue = {task.memory < 110.GB ? 'work' : 'highmem'}
    executor = 'slurm'
    withLabel: 'local_process' { executor = 'local' }
    clusterOptions='--account=PAS0471'
    queueSize = 100
    scratch = '$TMPDIR'
    queue = { task.memory.toGiga() > 178 ? 'largemem' : 'serial' }
}

profiles {
    conda {
        params.enable_conda    = true
        docker.enabled         = false
        singularity.enabled    = false
        podman.enabled         = false
        shifter.enabled        = false
        charliecloud.enabled   = false
    }
    mamba {
        params.enable_conda    = true
        conda.useMamba         = true
        docker.enabled         = false
        singularity.enabled    = false
        podman.enabled         = false
        shifter.enabled        = false
        charliecloud.enabled   = false
    }
    singularity {
        singularity.enabled    = true
        singularity.autoMounts = true
        docker.enabled         = false
        podman.enabled         = false
        shifter.enabled        = false
        charliecloud.enabled   = false
    }
}
